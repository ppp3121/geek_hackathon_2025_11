# 周辺施設検索API 仕様書

## 1. 概要

指定された緯度経度を中心として、指定されたカテゴリの周辺施設を検索し、一覧を返却するAPI。

-   **エンドポイントURL:** 'https://us-central1-geek-hackathon-2025-11.cloudfunctions.net/searchFacilities'
-   **メソッド:** `GET`

---

## 2. リクエスト

### クエリパラメータ

| パラメータ    | 型      | 必須 | 説明                                                              | 例                                   |
| :------------ | :------ | :--- | :---------------------------------------------------------------- | :----------------------------------- |
| `lat`         | number  | ✅   | 検索中心地の緯度（latitude）                                      | `35.6812`                            |
| `lon`         | number  | ✅   | 検索中心地の経度（longitude）                                     | `139.7671`                           |
| `radius`      | number  | 否   | 検索半径（メートル）。デフォルトは`1000`。                        | `500`                                |
| `amenities`   | string  | 否   | 検索したい施設のamenityタグ。カンマ区切りで複数指定可。デフォルトは`restaurant,cafe`。 | `restaurant,cafe,convenience`        |

**リクエスト例:**
`https://.../searchFacilities?lat=35.6812&lon=139.7671&radius=500&amenities=ramen,cafe`

---

## 3. レスポンス

### 成功時 (200 OK)

リクエストが成功した場合、`Facility`オブジェクトの配列をJSON形式で返却する。

#### `Facility` オブジェクトの構造

| フィールド   | 型     | 説明                               |
| :----------- | :----- | :--------------------------------- |
| `id`         | number | OpenStreetMapにおけるユニークID    |
| `name`       | string | 施設の名称                         |
| `lat`        | number | 施設の緯度                         |
| `lon`        | number | 施設の経度                         |
| `category`   | string | 施設のカテゴリ（amenityタグ）      |

#### レスポンスボディの例

```json
[
  {
    "id": 12345678,
    "name": "スターバックスコーヒー 〇〇店",
    "lat": 35.6815,
    "lon": 139.7675,
    "category": "cafe"
  },
  {
    "id": 87654321,
    "name": "〇〇ラーメン",
    "lat": 35.6809,
    "lon": 139.7669,
    "category": "ramen"
  }
]

### 4. エラーレスポンス

APIがエラーを返却する場合、HTTPステータスコードとエラーメッセージを含むJSONオブジェクトを返却します。

| ステータスコード | 意味                  | 発生条件                                                                                         | レスポンスボディの例                                                                   |
| :--------------- | :-------------------- | :----------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------- |
| `400`            | **Bad Request** | リクエストに必要なパラメータ（`lat`, `lon`）が不足している、または型が不正な場合。                | `{"error": "緯度(lat)と経度(lon)は必須です。"}`                                         |
| `429`            | **Too Many Requests** | 外部API（Overpass API）へのリクエストが集中し、一時的に利用が制限された場合。                      | `{"error": "検索リクエストが集中しています。しばらくしてから再度お試しください。"}`     |
| `502`            | **Bad Gateway** | 外部API（Overpass API）側で問題が発生し、施設情報を正常に取得できなかった場合。                   | `{"error": "施設情報の取得中にエラーが発生しました。"}`                                 |
| `503`            | **Service Unavailable** | 外部API（Overpass API）に接続できなかった場合。（※将来的にサーキットブレーカーを実装した場合にも使用） | `{"error": "検索サービスに接続できませんでした。"}`                                     |
| `504`            | **Gateway Timeout** | 外部API（Overpass API）からの応答が時間内に返ってこなかった場合。                                  | `{"error": "検索サービスが時間内に応答しませんでした。少し時間を置いて再度お試しください。"}` |

**エラーレスポンスの基本構造:**

```json
{
  "error": "エラーの理由を説明する文字列"
}